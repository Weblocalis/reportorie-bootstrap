<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculateur Prix HT ou TTC</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
    }
    header {
      background: #333;
      color: white;
      padding: 10px 20px;
      text-align: center;
    }
    main {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    label, input, select, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      font-size: 16px;
    }
    button {
      background: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f1f1f1;
      text-align: center;
      font-size: 18px;
    }
    .history {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #f1f1f1;
      font-size: 16px;
    }
    .history ul {
      list-style-type: none;
      padding: 0;
    }
    .history li {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <header>
    <h1>Calculateur Prix HT ou TTC</h1>
    <p>Calculez le prix HT ou TTC selon le taux de TVA</p>
  </header>
  <main>
    <form id="calculatorForm">
      <label for="amount">Montant :</label>
      <input type="number" id="amount" placeholder="Entrez un montant" required min="0" step="any" />

      <label for="vatRate">Sélectionner le taux de TVA :</label>
      <select id="vatRate">
        <option value="0.05">TVA 5.5% (réduit)</option>
        <option value="0.1">TVA 10% (réduit)</option>
        <option value="0.2">TVA 20% (normale)</option>
        <option value="0.055">TVA 5.5% (autre taux)</option>
        <option value="0.18">TVA 18%</option>
      </select>

      <label for="decimalPlaces">Nombre de décimales :</label>
      <select id="decimalPlaces">
        <option value="2">2 décimales</option>
        <option value="3">3 décimales</option>
        <option value="4">4 décimales</option>
      </select>

      <label for="calculationType">Calcul :</label>
      <select id="calculationType">
        <option value="htToTtc">Calculer TTC à partir de HT</option>
        <option value="ttcToHt">Calculer HT à partir de TTC</option>
      </select>

      <button type="button" id="calculateBtn">Calculer</button>
      <button type="button" id="swapBtn">Inverser les unités</button>
    </form>

    <div class="result" id="result" style="display: none;">
      <p id="calculationResult"></p>
      <p id="vatAmount"></p>
    </div>

    <div class="history" id="history">
      <h3>Historique des Calculs</h3>
      <ul id="historyList"></ul>
    </div>
  </main>

  <script>
    const historyList = document.getElementById("historyList");

    document.getElementById("calculateBtn").addEventListener("click", () => {
      const amount = parseFloat(document.getElementById("amount").value);
      const vatRate = parseFloat(document.getElementById("vatRate").value);
      const decimalPlaces = parseInt(document.getElementById("decimalPlaces").value);
      const calculationType = document.getElementById("calculationType").value;
      const resultDiv = document.getElementById("result");
      const calculationResult = document.getElementById("calculationResult");
      const vatAmount = document.getElementById("vatAmount");

      // Validation des entrées
      if (isNaN(amount) || amount <= 0 || isNaN(vatRate) || vatRate < 0) {
        alert("Veuillez entrer des valeurs valides pour le montant et le taux de TVA.");
        return;
      }

      let result, vat;

      // Calcul en fonction du type choisi
      if (calculationType === "htToTtc") {
        result = amount * (1 + vatRate);  // HT -> TTC
        vat = result - amount;  // Calcul de la TVA
        calculationResult.textContent = `${amount} € HT correspond à ${result.toFixed(decimalPlaces)} € TTC`;
      } else {
        result = amount / (1 + vatRate);  // TTC -> HT
        vat = amount - result;  // Calcul de la TVA
        calculationResult.textContent = `${amount} € TTC correspond à ${result.toFixed(decimalPlaces)} € HT`;
      }

      // Affichage de la TVA
      vatAmount.textContent = `Montant de la TVA : ${vat.toFixed(decimalPlaces)} €`;

      resultDiv.style.display = "block";

      // Ajouter à l'historique
      addToHistory(amount, vatRate, calculationType, result, vat, decimalPlaces);
    });

    // Fonction pour inverser les unités
    document.getElementById("swapBtn").addEventListener("click", () => {
      const calculationType = document.getElementById("calculationType");

      // Inverser les valeurs des unités
      if (calculationType.value === "htToTtc") {
        calculationType.value = "ttcToHt";
      } else {
        calculationType.value = "htToTtc";
      }
    });

    // Ajouter un calcul à l'historique
    function addToHistory(amount, vatRate, calculationType, result, vat, decimalPlaces) {
      const li = document.createElement("li");
      let historyText = '';

      if (calculationType === "htToTtc") {
        historyText = `${amount} € HT avec TVA ${vatRate * 100}% → ${result.toFixed(decimalPlaces)} € TTC (TVA: ${vat.toFixed(decimalPlaces)} €)`;
      } else {
        historyText = `${amount} € TTC avec TVA ${vatRate * 100}% → ${result.toFixed(decimalPlaces)} € HT (TVA: ${vat.toFixed(decimalPlaces)} €)`;
      }

      li.textContent = historyText;
      historyList.appendChild(li);
    }
  </script>
</body>
</html>
